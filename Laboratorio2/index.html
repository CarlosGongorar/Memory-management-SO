<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Simulador de Asignación de Memoria</title>
  <link rel="stylesheet" type="text/css" href="styles.css" />
</head>
<script>
/*
  Ajusta dinámicamente la altura de .memory-container para igualar la sección central,
  sin exceder la altura de la ventana (viewport).
  Si se acerca al borde inferior, se activa un scroll automático.
*/
(function () {
  const getCenterSection = () => document.querySelectorAll(".grid > .section")[1];
  const getMemoryContainer = () => document.querySelector(".memory-container");

  function syncMemoryHeight() {
    const center = getCenterSection();
    const mem = getMemoryContainer();
    if (!center || !mem) return;

    const viewportHeight = window.innerHeight;
    const headerHeight = document.querySelector("h1")?.offsetHeight || 0;
    const padding = 60; // margen visual

    const centerHeight = center.scrollHeight;
    const maxAllowed = viewportHeight - headerHeight - padding;

    // Si la sección central cabe dentro del viewport, usamos su altura;
    // si no, limitamos y agregamos scroll
    const newHeight = Math.min(centerHeight, maxAllowed);

    mem.style.maxHeight = newHeight + "px";
    mem.style.overflowY = centerHeight > maxAllowed ? "auto" : "hidden";
  }

  // Observa cambios de contenido
  function observeChanges() {
    const center = getCenterSection();
    if (!center) return;
    const observer = new MutationObserver(() => requestAnimationFrame(syncMemoryHeight));
    observer.observe(center, { childList: true, subtree: true });
  }

  // Eventos
  window.addEventListener("load", () => {
    syncMemoryHeight();
    observeChanges();
    setTimeout(syncMemoryHeight, 200);
    setTimeout(syncMemoryHeight, 1000);
  });
  window.addEventListener("resize", syncMemoryHeight);
})();
</script>

<body>
  <h1 style="text-align:center;">Simulador de Asignación de Memoria</h1>

  <div class="grid">
    <!-- ===========================
         SECCIÓN 1: SEGMENTACIÓN
    ============================ -->
    <div class="section">
      <h2>Configuración de Segmentación</h2>

      <div class="section">
        <h3>Seleccionar Tipo de Memoria:</h3>
        <select class="select" id="tipo_memoria">
          <option value="segmentacion" selected>Segmentación</option>
          <option value="paginacion">Paginación</option>
        </select>
      </div>

      <div class="section seg-info">
        <h3>Bits de Segmento</h3>
        <p>La dirección lógica es de 24 bits</p>

        <label for="tamSeg">Tamaño de partición:</label>
        <select class="select" id="tamSeg">
          <option value="3">3 bits</option>
          <option value="4">4 bits</option>
          <option value="5" selected>5 bits</option>
          <option value="6">6 bits</option>
          <option value="7">7 bits</option>
        </select>

        <table id="tablaSegmentacion" class="table">
          <thead>
            <tr>
              <th>Número máximo de Segmentos (x proceso)</th>
              <th>Offset Máximo</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td id="numSegmentos">32</td>
              <td id="offsetMax">524288</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="section">
        <h2>Agregar Programa</h2>
        <div class="program-list">
          <label for="nomPrograma">Nombre del Programa:</label>
          <input type="text" id="nomPrograma" placeholder="Ingrese el nombre del programa" />

          <label for="tamPrograma">Tamaño del código (Bytes):</label>
          <input type="number" id="tamPrograma" placeholder="Tamaño en KB" />

          <label for="dataPrograma">Tamaño de los datos inicializados (Bytes):</label>
          <input type="number" id="dataPrograma" placeholder="Tamaño en KB" />

          <label for="bssPrograma">Tamaño de los datos sin inicializar (Bytes):</label>
          <input type="number" id="bssPrograma" placeholder="Tamaño en KB" />

          <button class="button-common" onclick="addProgram()">Agregar Programa</button>
        </div>
      </div>
    </div>

    <!-- ===========================
         SECCIÓN 2: PROGRAMAS
    ============================ -->
    <div class="section">
      <h2>Programas y Ejecución</h2>

      <div class="program-list">
        <h3>Programas Instalados</h3>
        <p>
          Tamaño del .stack = 65536<br />
          Tamaño del .heap = 131072
        </p>

        <table id="programList" class="table">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>.text</th>
              <th>.data</th>
              <th>.bss</th>
              <th>Acción</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="contenedorTabla">
        <h3>Programas en Ejecución</h3>
        <table id="t-ejecucion" class="table">
          <thead>
            <tr>
              <th>PID</th>
              <th>Nombre del Programa</th>
              <th>Tamaño</th>
              <th>Terminar proceso</th>
            </tr>
          </thead>
          <tbody id="runningProgramsTable"></tbody>
        </table>

        <h3>Divisiones (Segmentos)</h3>
        <table id="t-segmentos" class="table">
          <thead id="t-seg-head"></thead>
          <tbody id="segments"></tbody>
        </table>
      </div>
    </div>

    <!-- ===========================
         SECCIÓN 3: MEMORIA
    ============================ -->
    <div class="section memory-container">
      <h2>Vista de Memoria</h2>
      <div class="memory-wrapper">
        <table id="grafico" class="tabla-memoria">
          <thead>
            <tr>
              <td id="t1">Hex</td>
              <td id="t2">Dec</td>
              <td>Programa</td>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>0x0</td>
              <td>0</td>
              <td>SO</td>
            </tr>
            <tr>
              <td>0xA</td>
              <td>10</td>
              <td></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- BARRA lateral -->
  <div class="Barra"></div>

  <!-- Scripts -->
  <script src="modelo.js"></script>
  <script src="estadoAjuste.js"></script>
  <script src="estadoGestMem.js"></script>
  <script src="control.js"></script>
</body>
</html>
